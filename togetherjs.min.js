!function(){let e={dontShowClicks:!1,cloneClicks:!1,enableAnalytics:!1,analyticsCode:"UA-35433268-28",hubBase:null,getUserName:null,getUserColor:null,getUserAvatar:null,siteName:null,useMinimizedCode:void 0,on:{},hub_on:{},enableShortcut:!1,toolName:null,findRoom:null,autoStart:!1,suppressJoinConfirmation:!1,suppressInvite:!1,inviteFromRoom:null,storagePrefix:"togetherjs",includeHashInUrl:!1,disableWebRTC:!1,youtube:!0,ignoreMessages:["cursor-update","keydown","scroll-update"],ignoreForms:[":password"]};const o="/togetherjs/togetherjs.css",t=window.TogetherJSConfig_baseURL;let n="";"__baseUrl__"==(n=t||"https://togetherjs.com")&&(n="");let r=!0,i=localStorage.getItem("togetherjs.baseUrlOverride");if(i){try{i=JSON.parse(i)}catch(e){i=null}if(!i||i.expiresAt<Date.now())localStorage.removeItem("togetherjs.baseUrlOverride");else{n=i.baseUrl;let e=console.warn||console.log;e.call(console,"Using TogetherJS baseUrlOverride:",n),e.call(console,"To undo run: localStorage.removeItem('togetherjs.baseUrlOverride')")}}let s=localStorage.getItem("togetherjs.configOverride");if(s){try{s=JSON.parse(s)}catch(e){s=null}if(!s||s.expiresAt<Date.now())localStorage.removeItem("togetherjs.configOverride");else{let e=!1;for(let o in s)"expiresAt"!=o&&s.hasOwnProperty(o)&&(e||(console.warn("Using TogetherJS configOverride"),console.warn("To undo run: localStorage.removeItem('togetherjs.configOverride')")),window["TogetherJSConfig_"+o]=s[o],console.log("Config override:",o,"=",s[o]))}}let l="unknown",a="";if(a&&""!=a?l=a:a=Date.now()+"","undefined"==typeof console&&(console={}),console.log||(console.log=function(){}),["debug","info","warn","error"].forEach(function(e){console[e]||(console[e]=console.log)}),!n){let e=document.getElementsByTagName("script");for(let o=0;o<e.length;o++){let t=e[o].src;if(t&&-1!==t.search(/togetherjs.js(\?.*)?$/)){n=t.replace(/\/*togetherjs.js(\?.*)?$/,""),console.warn("Detected baseUrl as",n);break}if(t&&-1!==t.search(/togetherjs-min.js(\?.*)?$/)){n=t.replace(/\/*togetherjs-min.js(\?.*)?$/,""),console.warn("Detected baseUrl as",n);break}}}function c(){if(!document.getElementById("togetherjs-stylesheet")){let e=document.createElement("link");e.id="togetherjs-stylesheet",e.setAttribute("rel","stylesheet"),e.href=n+o+"?bust="+a,document.head.appendChild(e)}}function u(e){let o=document.createElement("script");o.src=n+e+"?bust="+a,document.head.appendChild(o)}n||console.warn("Could not determine TogetherJS's baseUrl (looked for a <script> with togetherjs.js and togetherjs-min.js)");let f=window.TogetherJS=function e(o){if(e.running){return void e.require("session").close()}e.startup.button=null;try{o&&"object"==typeof o&&(o.target?e.startup.button=o.target:1==o.nodeType?e.startup.button=o:o[0]&&1==o[0].nodeType&&(e.startup.button=o[0]))}catch(e){console.warn("Error determining starting button:",e)}let t,n;window.TowTruckConfig&&(console.warn("TowTruckConfig is deprecated; please use TogetherJSConfig"),window.TogetherJSConfig?console.warn("Ignoring TowTruckConfig in favor of TogetherJSConfig"):window.TogetherJSConfig=TowTruckConfig),window.TogetherJSConfig&&!window.TogetherJSConfig.loaded&&(e.config(window.TogetherJSConfig),window.TogetherJSConfig.loaded=!0);let i={};for(t in window)0===t.indexOf("TogetherJSConfig_on_")?i[n=t.substr("TogetherJSConfig_on_".length)]=window[t]:0===t.indexOf("TogetherJSConfig_")?(n=t.substr("TogetherJSConfig_".length),e.config(n,window[t])):0===t.indexOf("TowTruckConfig_on_")?(n=t.substr("TowTruckConfig_on_".length),console.warn("TowTruckConfig_* is deprecated, please rename",t,"to TogetherJSConfig_on_"+n),i[n]=window[t]):0===t.indexOf("TowTruckConfig_")&&(n=t.substr("TowTruckConfig_".length),console.warn("TowTruckConfig_* is deprecated, please rename",t,"to TogetherJSConfig_"+n),e.config(n,window[t]));let s=e.config.get("on");for(t in i)i.hasOwnProperty(t)&&(s[t]=i[t]);for(t in e.config("on",s),s)e.on(t,s[t]);let l=e.config.get("hub_on");if(l)for(t in l)l.hasOwnProperty(t)&&e.hub.on(t,l[t]);if(e.startup.reason||(e.startup.reason="started"),e._loaded){let o=e.require("session");return c(),void o.start()}e.startup._launch=!0,c();let a=e.config.get("useMinimizedCode");e.config.close("useMinimizedCode"),void 0!==a&&(r=!!a);let f=e._extend(e.requireConfig),g=["session","jquery"];function h(o,t){e._loaded=!0,r||(e.require=require.config({context:"togetherjs"}),e._requireObject=require)}if(!r&&"function"==typeof require){if(!require.config)throw console.warn("The global require (",require,") is not requirejs; please use togetherjs-min.js"),new Error("Conflict with window.require");e.require=require.config(f)}"function"==typeof e.require?e.require(g,h):(f.deps=g,f.callback=h,r||(window.require=f)),u(r?"/togetherjs/togetherjsPackage.min.js":"/togetherjs/libs/require.js")};f.pageLoaded=Date.now(),f._extend=function(e,o){o||(o=e,e={});for(let t in o)o.hasOwnProperty(t)&&(e[t]=o[t]);return e},f._startupInit={button:null,reason:null,continued:!1,_joinShareId:null,_launch:!1},f.startup=f._extend(f._startupInit),f.running=!1,f.requireConfig={context:"togetherjs",baseUrl:n+"/togetherjs",urlArgs:"bust="+a,paths:{jquery:"libs/jquery.min",walkabout:"libs/walkabout/walkabout",esprima:"libs/walkabout/lib/esprima",falafel:"libs/walkabout/lib/falafel",tinycolor:"libs/tinycolor",whrandom:"libs/whrandom/random"}},f._mixinEvents=function(e){return e.on=function(e,o){if("function"!=typeof o)throw console.warn("Bad callback for",this,".once(",e,", ",o,")"),"Error: .once() called with non-callback";if(-1==e.search(" ")){if(this._knownEvents&&-1==this._knownEvents.indexOf(e)){let o=""+this;o.length>20&&(o=o.substr(0,20)+"..."),console.warn(o+".on('"+e+"', ...): unknown event"),console.trace&&console.trace()}this._listeners||(this._listeners={}),this._listeners[e]||(this._listeners[e]=[]),-1==this._listeners[e].indexOf(o)&&this._listeners[e].push(o)}else{e.split(/ +/g).forEach(function(e){this.on(e,o)},this)}},e.once=function(e,o){if("function"!=typeof o)throw console.warn("Bad callback for",this,".once(",e,", ",o,")"),"Error: .once() called with non-callback";let t="onceCallback_"+e;o[t]||(o[t]=function n(){o.apply(this,arguments),this.off(e,n),delete o[t]}),this.on(e,o[t])},e.off=e.removeListener=function(e,o){if(this._listenerOffs)return void this._listenerOffs.push([e,o]);if(-1!=e.search(" ")){return void e.split(/ +/g).forEach(function(e){this.off(e,o)},this)}if(!this._listeners||!this._listeners[e])return;let t=this._listeners[e],n=t.length;for(let e=0;e<n;e++)if(t[e]==o){t.splice(e,1);break}},e.emit=function(e){let o=this._listenerOffs=[];if(!this._listeners||!this._listeners[e])return;let t=Array.prototype.slice.call(arguments,1);this._listeners[e].forEach(function(e){e.apply(this,t)},this),delete this._listenerOffs,o.length&&o.forEach(function(e){this.off(e[0],e[1])},this)},e},f._teardown=function(){let e=f._requireObject||window.require;e.s&&e.s.contexts&&delete e.s.contexts.togetherjs,f._loaded=!1,f.startup=f._extend(f._startupInit),f.running=!1},f._mixinEvents(f),f._knownEvents=["ready","close"],f.toString=function(){return"TogetherJS"};let g="https://hub.togetherjs.com";"__hubUrl__"==g&&(g="https://hub.togetherjs.mozillalabs.com"),e.hubBase=g,f._configuration={},f._defaultConfiguration=e,f._configTrackers={},f._configClosed={},f.config=function(e,o){let t,n,r;if(1==arguments.length){if("object"!=typeof e)throw new Error("TogetherJS.config(value) must have an object value (not: "+e+")");t=e}else(t={})[e]=o;for(let e in t)if(t.hasOwnProperty(e)&&f._configClosed[e]&&f.running)throw new Error("The configuration "+e+" is finalized and cannot be changed");for(let o in t){if(!t.hasOwnProperty(o))continue;if("loaded"==o||"callToStart"==o)continue;f._defaultConfiguration.hasOwnProperty(o)||console.warn("Unknown configuration value passed to TogetherJS.config():",o);let i=f._configuration[o],s=t[o];f._configuration[o]=s;let l=f._configTrackers[e]||[],a=!1;for(n=0;n<l.length;n++)try{(r=l[n])(s,i)}catch(o){console.warn("Error setting configuration",e,"to",s,":",o,"; reverting to",i),a=!0;break}if(a)for(f._configuration[o]=i,n=0;n<l.length;n++)try{(r=l[n])(s)}catch(o){console.warn("Error REsetting configuration",e,"to",i,":",o,"(ignoring)")}}},f.config.get=function(e){let o=f._configuration[e];return void 0===o&&(f._defaultConfiguration.hasOwnProperty(e)||console.error("Tried to load unknown configuration value:",e),o=f._defaultConfiguration[e]),o},f.config.track=function(e,o){if(!f._defaultConfiguration.hasOwnProperty(e))throw new Error("Configuration is unknown: "+e);return o(f.config.get(e)),f._configTrackers[e]||(f._configTrackers[e]=[]),f._configTrackers[e].push(o),o},f.config.close=function(e){if(!f._defaultConfiguration.hasOwnProperty(e))throw new Error("Configuration is unknown: "+e);f._configClosed[e]=!0},f.reinitialize=function(){f.running&&"function"==typeof f.require&&f.require(["session"],function(e){e.emit("reinitialize")})},f.refreshUserData=function(){f.running&&"function"==typeof f.require&&f.require(["session"],function(e){e.emit("refresh-user-data")})},f.version=l,f.baseUrl=n,f.hub=f._mixinEvents({}),f._onmessage=function(e){let o=e.type;o=0===o.search(/^app\./)?o.substr("app.".length):"togetherjs."+o,e.type=o,f.hub.emit(e.type,e)},f.send=function(e){if(!f.require)throw"You cannot use TogetherJS.send() when TogetherJS is not running";f.require("session").appSend(e)},f.shareUrl=function(){if(!f.require)return null;return f.require("session").shareUrl()};let h=null;f.listenForShortcut=function(){console.warn("Listening for alt-T alt-T to start TogetherJS"),f.removeShortcut(),h=function e(o){84==o.which&&o.altKey?e.pressed?f():e.pressed=!0:e.pressed=!1},f.once("ready",f.removeShortcut),document.addEventListener("keyup",h,!1)},f.removeShortcut=function(){h&&(document.addEventListener("keyup",h,!1),h=null)},f.config.track("enableShortcut",function(e,o){e?f.listenForShortcut():o&&f.removeShortcut()}),f.checkForUsersOnChannel=function(e,o){0===e.search(/^https?:/i)&&(e=e.replace(/^http/i,"ws"));let t=new WebSocket(e),n=!1;t.onmessage=function(e){let r=JSON.parse(e.data);if("init-connection"==r.type){if(n)return console.warn("Somehow received two responses from channel; ignoring second"),void t.close();n=!0,t.close(),o(r.peerCount)}else console.warn("Got unexpected first message (should be init-connection):",r)},t.onclose=t.onerror=function(){n||(console.warn("Socket was closed without receiving answer"),n=!0,o(void 0))}};let d=location.hash.replace(/^#/,""),w=/&?togetherjs=([^&]*)/.exec(d);if(w){f.startup._joinShareId=w[1],f.startup.reason="joined";let e=d.substr(0,w.index)+d.substr(w.index+w[0].length);location.hash=e}function p(){if(f.startup._joinShareId)f();else if(window._TogetherJSBookmarklet)delete window._TogetherJSBookmarklet,f();else{let e="togetherjs-session.status",o=sessionStorage.getItem(e);o?(o=JSON.parse(o))&&o.running&&(f.startup.continued=!0,f.startup.reason=o.startupReason,f()):(window.TogetherJSConfig_autoStart||window.TogetherJSConfig&&window.TogetherJSConfig.autoStart)&&(f.startup.reason="joined",f())}}window._TogetherJSShareId&&(f.startup._joinShareId=window._TogetherJSShareId,delete window._TogetherJSShareId),function(){if(window.TogetherJSConfig_noAutoStart)return;let e=window.TogetherJSConfig_callToStart;!e&&window.TowTruckConfig_callToStart&&(e=window.TowTruckConfig_callToStart,console.warn("Please rename TowTruckConfig_callToStart to TogetherJSConfig_callToStart")),window.TogetherJSConfig&&window.TogetherJSConfig.callToStart&&(e=window.TogetherJSConfig.callToStart),e?e(p):p()}(),window.TogetherJSConfig_enableShortcut&&f.listenForShortcut(),window.TowTruck=f}();